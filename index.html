<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terra Helix</title>
    <style>
       html, body { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
    .ol-popup {
      background: white;
      border-radius: 5px;
      padding: 10px;
      border: 1px solid #ccc;
      min-width: 150px;
    }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="popup" class="ol-popup"></div>
</body>
<script src="https://cdn.jsdelivr.net/npm/ol@v9.2.4/dist/ol.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
    const map = new ol.Map({
    target: 'map',
    layers: [
        new ol.layer.Tile({
        source: new ol.source.OSM()
        })
    ],
    view: new ol.View({
        center: ol.proj.fromLonLat([0, 20]),
        zoom: 2
    })
    });
    const vectorSource = new ol.source.Vector();
const vectorLayer = new ol.layer.Vector({
  source: vectorSource,
  style: new ol.style.Style({
    image: new ol.style.Circle({
      radius: 6,
      fill: new ol.style.Fill({ color: 'red' }),
      stroke: new ol.style.Stroke({ color: 'white', width: 2 })
    })
  })
});
map.addLayer(vectorLayer);

// Popup overlay
const popup = document.getElementById('popup');
const overlay = new ol.Overlay({
  element: popup,
  positioning: 'bottom-center',
  stopEvent: false,
  offset: [0, -10]
});
map.addOverlay(overlay);

// Load CSV and add points
Papa.parse('charities_geocoded.csv', {
  download: true,
  header: true,
  complete: function(results) {
    results.data.forEach(row => {
      if (!row.longitude || !row.latitude) return;

      const feature = new ol.Feature({
        geometry: new ol.geom.Point(
          ol.proj.fromLonLat([parseFloat(row.longitude), parseFloat(row.latitude)])
        ),
        data: row
      });
      vectorSource.addFeature(feature);
    });
  }
});

// On click, show popup with feature details
map.on('singleclick', function(evt) {
  const feature = map.forEachFeatureAtPixel(evt.pixel, f => f);
  if (feature) {
    const props = feature.get('data');
    const coord = feature.getGeometry().getCoordinates();
    const html = `
      <strong>${props.name}</strong><br>
      ${props.description}<br>
      <em>(${props.latitude}, ${props.longitude})</em>
    `;
    popup.innerHTML = html;
    overlay.setPosition(coord);
  } else {
    overlay.setPosition(undefined);
  }
});
</script>

</html>


